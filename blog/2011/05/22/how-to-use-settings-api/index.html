<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>如何使用 Settings API 製作佈景後台選項？ | Zespia</title>
  <meta name="author" content="SkyArrow">
  
  <meta name="description" content="隨著 WordPress 版本號的推進，不只系統越變越肥大，外掛、佈景主題的條件也越來越嚴苛，全部規定必須使用官方的現有函數製作，雖然 WordPress 的函數庫真的很豐富很好用，不過這麼獨裁的規定著實讓人很不爽。


因此，由於官方要求，我必須使用 Settings API 來製作主題選項，但官方文件的資料的資訊實在太少了，在下沒慧根實在看不懂，經過 Google 百般尋覓後，將我較喜歡的幾篇文章（見參考出處）整合寫成了這篇文章，我沒有 PHP 底子，只有在圖書館翻過幾本書，內文可能會有些錯誤，請見諒。">
  
  
  <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

  <meta property="og:title" content="如何使用 Settings API 製作佈景後台選項？"/>
  <meta property="og:site_name" content="Zespia"/>

  <link rel="alternate" href="http://feeds.feedburner.com/zespia" title="Zespia" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4910098-7']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Zespia</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="https://github.com/tommy351">GitHub</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">

<article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-05-22T08:02:00.000Z"><a href="/blog/2011/05/22/how-to-use-settings-api/">2011/5/22</a></time>
      
      
  
    <h1 class="title">如何使用 Settings API 製作佈景後台選項？</h1>
  

    </header>
    <div class="entry">
      
        <p>隨著 WordPress 版本號的推進，不只系統越變越肥大，外掛、佈景主題的條件也越來越嚴苛，全部規定必須使用官方的現有函數製作，雖然 WordPress 的函數庫真的很豐富很好用，不過這麼獨裁的規定著實讓人很不爽。

</p>
<p>因此，由於官方要求，我必須使用 Settings API 來製作主題選項，但官方文件的資料的資訊實在太少了，在下沒慧根實在看不懂，經過 Google 百般尋覓後，將我較喜歡的幾篇文章（見參考出處）整合寫成了這篇文章，我沒有 PHP 底子，只有在圖書館翻過幾本書，內文可能會有些錯誤，請見諒。

</p>
<span id="more"></span>

<h2>基礎架構</h2>
<p>首先，建立一個空白的<code>php</code>檔案，以下以<code>function-admin.php</code>為例，實際情況依個人設定而有差異。然後，在<code>function.php</code>寫入下列程式碼，以引入<code>function-admin.php</code>這個外部檔案。

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="keyword">if</span> ( file_exists( TEMPLATEPATH.<span class="string">'/function-admin.php'</span> ) ) {</div><div class="line">	<span class="keyword">require_once</span>( TEMPLATEPATH.<span class="string">'/function-admin.php'</span> );</div><div class="line">	<span class="variable">$theme_option</span> = <span class="keyword">new</span> theme_option();</div><div class="line">}</div></code></pre></td></tr></table></figure>

<p>接著在<code>function-admin.php</code>建立<code>class</code>，以下以<code>theme_option</code>為例：

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div><div class="line-number">24</div><div class="line-number">25</div><div class="line-number">26</div><div class="line-number">27</div><div class="line-number">28</div><div class="line-number">29</div><div class="line-number">30</div><div class="line-number">31</div><div class="line-number">32</div><div class="line-number">33</div><div class="line-number">34</div><div class="line-number">35</div><div class="line-number">36</div><div class="line-number">37</div><div class="line-number">38</div><div class="line-number">39</div><div class="line-number">40</div><div class="line-number">41</div><div class="line-number">42</div></code></pre></td><td class="code"><pre><code><div class="line">&lt;?php</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">theme_option</span> {</span></div><div class="line">	<span class="comment">// 建立選項區段</span></div><div class="line">	<span class="keyword">private</span> <span class="variable">$sections</span>;</div><div class="line"> </div><div class="line">	<span class="comment">// 各個選項的預設值</span></div><div class="line">	<span class="keyword">private</span> <span class="variable">$defaults</span> = <span class="keyword">array</span>(</div><div class="line">		<span class="string">'test_checkbox'</span> =&gt; <span class="string">'0'</span>, <span class="comment">// 0 為停用，1 為啟用</span></div><div class="line">		<span class="string">'test_text'</span> =&gt; <span class="string">''</span>,</div><div class="line">		<span class="string">'test_select'</span> =&gt; <span class="string">'one'</span>,</div><div class="line">		<span class="string">'test_radio'</span> =&gt; <span class="string">'one'</span>,</div><div class="line">		<span class="string">'test_textarea'</span> =&gt; <span class="string">''</span></div><div class="line">	);</div><div class="line"> </div><div class="line">	<span class="comment">// checkbox 的陣列，如果選項類型是 checkbox 的話，可能會出一些 "Undefined Index" 的問題，所以需要特別處理</span></div><div class="line">	<span class="keyword">private</span> <span class="variable">$checkboxes</span>;</div><div class="line"> </div><div class="line">	<span class="comment">// 初始化</span></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> {</span></div><div class="line">		<span class="variable">$this</span>-&gt;checkboxes = <span class="keyword">array</span>();</div><div class="line"> </div><div class="line">		<span class="variable">$this</span>-&gt;sections[<span class="string">'general'</span>] = <span class="string">'General'</span>;</div><div class="line">		<span class="variable">$this</span>-&gt;sections[<span class="string">'reading'</span>] = <span class="string">'Reading'</span>;</div><div class="line">		<span class="variable">$this</span>-&gt;sections[<span class="string">'other'</span>] = <span class="string">'Other'</span>;</div><div class="line"> </div><div class="line">		<span class="comment">// 將各個選項的預設值寫入資料庫</span></div><div class="line">		<span class="variable">$DBOptions</span> = get_option(<span class="string">'pixiv_options'</span>);</div><div class="line">		<span class="variable">$defaults</span> = <span class="variable">$this</span>-&gt;defaults;</div><div class="line"> </div><div class="line">		<span class="keyword">if</span> ( !is_array(<span class="variable">$DBOptions</span>) ) <span class="variable">$DBOptions</span> = <span class="keyword">array</span>();</div><div class="line"> </div><div class="line">		<span class="keyword">foreach</span> ( <span class="variable">$DBOptions</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span> ) {</div><div class="line">			<span class="keyword">if</span> ( <span class="keyword">isset</span>(<span class="variable">$DBOptions</span>[<span class="variable">$key</span>]) )</div><div class="line">				<span class="variable">$defaults</span>[<span class="variable">$key</span>] = <span class="variable">$DBOptions</span>[<span class="variable">$key</span>];</div><div class="line">		}</div><div class="line">		update_option(<span class="string">'pixiv_options'</span>, <span class="variable">$defaults</span>);</div><div class="line"> </div><div class="line">		add_action( <span class="string">'admin_menu'</span>, <span class="keyword">array</span>( &<span class="variable">$this</span>, <span class="string">'add_pages'</span> ) );</div><div class="line">		add_action( <span class="string">'admin_init'</span>, <span class="keyword">array</span>( &<span class="variable">$this</span>, <span class="string">'register_settings'</span> ) );</div><div class="line">	}</div><div class="line">}</div><div class="line">?&gt;</div></code></pre></td></tr></table></figure>

<p>初始化完成後，接著就可邁入下一個步驟「<strong>註冊設定</strong>」。

</p>
<h2>註冊設定</h2>
<p>為了要讓佈景選項出現在選單上，新增一個名為<code>add_pages</code>的函數：

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_pages</span><span class="params">()</span> {</span></div><div class="line">	<span class="variable">$admin_page</span> = add_theme_page( <span class="string">'Theme Options'</span>, <span class="string">'Theme Options'</span>, <span class="string">'edit_theme_options'</span>, <span class="string">'test-settings'</span>, <span class="keyword">array</span>( &<span class="variable">$this</span>, <span class="string">'display_page'</span> ) );</div><div class="line">}</div></code></pre></td></tr></table></figure>

<p>Settings API 的設計雖然提供了一個更簡單的註冊設定的方式，但那僅限於選項很少的時候，若是 Pixiv Custom 這種選項數高達 51 項的主題就不可能一項一項編寫、呼叫個別的函數了，所以我們建立名為<code>create_setting</code>的函數，以精簡、整齊代碼。

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div><div class="line-number">24</div><div class="line-number">25</div><div class="line-number">26</div><div class="line-number">27</div><div class="line-number">28</div><div class="line-number">29</div><div class="line-number">30</div><div class="line-number">31</div><div class="line-number">32</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create_setting</span><span class="params">( <span class="variable">$args</span> = array<span class="params">()</span> )</span> {</span></div><div class="line">	<span class="variable">$defaults</span> = <span class="keyword">array</span>(</div><div class="line">		<span class="string">'id'</span>		=&gt; <span class="string">''</span>, <span class="comment">// 選項 id</span></div><div class="line">		<span class="string">'title'</span>		=&gt; <span class="string">''</span>, <span class="comment">// 選項標題</span></div><div class="line">		<span class="string">'desc'</span>		=&gt; <span class="string">''</span>, <span class="comment">// 選項敘述</span></div><div class="line">		<span class="string">'type'</span>		=&gt; <span class="string">'text'</span>, <span class="comment">// 選項類型</span></div><div class="line">		<span class="string">'section'</span>	=&gt; <span class="string">'general'</span>, <span class="comment">// 選項區段（__construct 函數中所設定的參數）</span></div><div class="line">		<span class="string">'choices'</span>	=&gt; <span class="keyword">array</span>(), <span class="comment">// 選項分支（供 radio, select 用）</span></div><div class="line">		<span class="string">'class'</span>		=&gt; <span class="string">''</span>, <span class="comment">// 選項 class</span></div><div class="line">		<span class="string">'before'</span>	=&gt; <span class="string">''</span>, <span class="comment">// 選項前的文字</span></div><div class="line">		<span class="string">'after'</span>		=&gt; <span class="string">''</span> <span class="comment">// 選項後的文字</span></div><div class="line">	);</div><div class="line"> </div><div class="line">	extract( wp_parse_args( <span class="variable">$args</span>, <span class="variable">$defaults</span> ) );</div><div class="line"> </div><div class="line">	<span class="variable">$field_args</span> = <span class="keyword">array</span>(</div><div class="line">		<span class="string">'type'</span>		=&gt; <span class="variable">$type</span>,</div><div class="line">		<span class="string">'id'</span>		=&gt; <span class="variable">$id</span>,</div><div class="line">		<span class="string">'desc'</span>		=&gt; <span class="variable">$desc</span>,</div><div class="line">		<span class="string">'choices'</span>	=&gt; <span class="variable">$choices</span>,</div><div class="line">		<span class="string">'label_for'</span>	=&gt; <span class="variable">$id</span>,</div><div class="line">		<span class="string">'class'</span>		=&gt; <span class="variable">$class</span>,</div><div class="line">		<span class="string">'before'</span>	=&gt; <span class="variable">$before</span>,</div><div class="line">		<span class="string">'after'</span>		=&gt; <span class="variable">$after</span></div><div class="line">	);</div><div class="line"> </div><div class="line">	add_settings_field( <span class="variable">$id</span>, <span class="variable">$title</span>, <span class="keyword">array</span>( <span class="variable">$this</span>, <span class="string">'display_settings'</span> ), <span class="string">'test-settings'</span>, <span class="variable">$section</span>, <span class="variable">$field_args</span> );</div><div class="line"> </div><div class="line">	<span class="comment">// 若選項類型為 checkbox，將其加入 checkboxes 陣列</span></div><div class="line">	<span class="keyword">if</span> ( <span class="variable">$type</span> = <span class="string">'checkbox'</span> )</div><div class="line">		<span class="variable">$this</span>-&gt;checkboxes[] = <span class="variable">$id</span>;</div><div class="line">}</div></code></pre></td></tr></table></figure>

<p>若陣列內容為空白，則會依照<code>defaults</code>來建立選項。可依個人使用的不同，加入或刪除變數。

</p>
<p>接著就得分別填入每個選項的參數了，建立一個名為<code>register_settings</code>的函數。

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div><div class="line-number">24</div><div class="line-number">25</div><div class="line-number">26</div><div class="line-number">27</div><div class="line-number">28</div><div class="line-number">29</div><div class="line-number">30</div><div class="line-number">31</div><div class="line-number">32</div><div class="line-number">33</div><div class="line-number">34</div><div class="line-number">35</div><div class="line-number">36</div><div class="line-number">37</div><div class="line-number">38</div><div class="line-number">39</div><div class="line-number">40</div><div class="line-number">41</div><div class="line-number">42</div><div class="line-number">43</div><div class="line-number">44</div><div class="line-number">45</div><div class="line-number">46</div><div class="line-number">47</div><div class="line-number">48</div><div class="line-number">49</div><div class="line-number">50</div><div class="line-number">51</div><div class="line-number">52</div><div class="line-number">53</div><div class="line-number">54</div><div class="line-number">55</div><div class="line-number">56</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register_settings</span><span class="params">()</span> {</span></div><div class="line">	register_setting( <span class="string">'test_options'</span>, <span class="string">'test_options'</span>, <span class="keyword">array</span>( &<span class="variable">$this</span>, <span class="string">'validate_settings'</span> ) );</div><div class="line"> </div><div class="line">	<span class="comment">// 新增選項區段</span></div><div class="line">	<span class="keyword">foreach</span> ( <span class="variable">$this</span>-&gt;sections <span class="keyword">as</span> <span class="variable">$slug</span> =&gt; <span class="variable">$title</span> )</div><div class="line">		add_settings_section( <span class="variable">$slug</span>, <span class="string">''</span>, <span class="keyword">array</span>( &<span class="variable">$this</span>, <span class="string">'display_section'</span> ), <span class="string">'test-settings'</span> );</div><div class="line"> </div><div class="line">	<span class="comment">// checkbox 設定</span></div><div class="line">	<span class="variable">$this</span>-&gt;create_setting( <span class="keyword">array</span> (</div><div class="line">		<span class="string">'id'</span>		=&gt; <span class="string">'test_checkbox'</span>,</div><div class="line">		<span class="string">'title'</span>		=&gt; <span class="string">'Test Checkbox'</span>,</div><div class="line">		<span class="string">'desc'</span>		=&gt; <span class="string">'Test Checkbox'</span>,</div><div class="line">		<span class="string">'type'</span>		=&gt; <span class="string">'checkbox'</span>,</div><div class="line">		<span class="string">'section'</span>	=&gt; <span class="string">'general'</span></div><div class="line">	) );</div><div class="line">	<span class="comment">// text 設定</span></div><div class="line">	<span class="variable">$this</span>-&gt;create_setting( <span class="keyword">array</span> (</div><div class="line">		<span class="string">'id'</span>		=&gt; <span class="string">'test_text'</span>,</div><div class="line">		<span class="string">'title'</span>		=&gt; <span class="string">'Test Text'</span>,</div><div class="line">		<span class="string">'desc'</span>		=&gt; <span class="string">'Test Text'</span>,</div><div class="line">		<span class="string">'type'</span>		=&gt; <span class="string">'text'</span>,</div><div class="line">		<span class="string">'section'</span>	=&gt; <span class="string">'general'</span></div><div class="line">	) );</div><div class="line">	<span class="comment">// select 設定</span></div><div class="line">	<span class="variable">$this</span>-&gt;create_setting( <span class="keyword">array</span> (</div><div class="line">		<span class="string">'id'</span>		=&gt; <span class="string">'test_select'</span>,</div><div class="line">		<span class="string">'title'</span>		=&gt; <span class="string">'Test Select'</span>,</div><div class="line">		<span class="string">'desc'</span>		=&gt; <span class="string">'Test Select'</span>,</div><div class="line">		<span class="string">'type'</span>		=&gt; <span class="string">'select'</span>,</div><div class="line">		<span class="string">'section'</span>	=&gt; <span class="string">'general'</span>,</div><div class="line">		<span class="string">'choices'</span>	=&gt; <span class="keyword">array</span>(</div><div class="line">			<span class="string">'one'</span>	=&gt; <span class="string">'Option One'</span>,</div><div class="line">			<span class="string">'two'</span>	=&gt; <span class="string">'Option Two'</span></div><div class="line">		)</div><div class="line">	) );</div><div class="line">	<span class="comment">// radio 設定</span></div><div class="line">	<span class="variable">$this</span>-&gt;create_setting( <span class="keyword">array</span> (</div><div class="line">		<span class="string">'id'</span>		=&gt; <span class="string">'test_radio'</span>,</div><div class="line">		<span class="string">'title'</span>		=&gt; <span class="string">'Test Radio'</span>,</div><div class="line">		<span class="string">'desc'</span>		=&gt; <span class="string">'Test Raio'</span>,</div><div class="line">		<span class="string">'type'</span>		=&gt; <span class="string">'radio'</span>,</div><div class="line">		<span class="string">'section'</span>	=&gt; <span class="string">'general'</span>,</div><div class="line">		<span class="string">'choices'</span>	=&gt; <span class="keyword">array</span>(</div><div class="line">			<span class="string">'one'</span>	=&gt; <span class="string">'Option One'</span>,</div><div class="line">			<span class="string">'two'</span>	=&gt; <span class="string">'Option Two'</span></div><div class="line">		)</div><div class="line">	) );</div><div class="line">	<span class="comment">// textarea 設定</span></div><div class="line">	<span class="variable">$this</span>-&gt;create_setting( <span class="keyword">array</span> (</div><div class="line">		<span class="string">'id'</span>		=&gt; <span class="string">'test_textarea'</span>,</div><div class="line">		<span class="string">'title'</span>		=&gt; <span class="string">'Test Textarea'</span>,</div><div class="line">		<span class="string">'desc'</span>		=&gt; <span class="string">'Test Textarea'</span>,</div><div class="line">		<span class="string">'type'</span>		=&gt; <span class="string">'textarea'</span>,</div><div class="line">		<span class="string">'section'</span>	=&gt; <span class="string">'general'</span></div><div class="line">	) );</div><div class="line">}</div></code></pre></td></tr></table></figure>

<p>到了這裡，只不過是設定了各個選項的數值罷了，選項頁面還是一片空白，喝點水休息一下，下一步就要正式設定選項頁面的內容了。

</p>
<h2>顯示頁面</h2>
<p>首先，新增一個名為<code>display_page</code>的函數。

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display_page</span><span class="params">()</span> {</span> ?&gt;</div><div class="line">	&lt;div class=<span class="string">"wrap"</span>&gt;</div><div class="line">		&lt;div class=<span class="string">"icon32"</span> id=<span class="string">"icon-themes"</span>&gt;&lt;/div&gt;</div><div class="line">		&lt;h2&gt;Theme Options&lt;/h2&gt;</div><div class="line">		&lt;form action=<span class="string">"options.php"</span> method=<span class="string">"post"</span> id=<span class="string">"test_admin"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</div><div class="line">			&lt;?php</div><div class="line">			<span class="keyword">if</span> ( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[<span class="string">'settings-updated'</span>] ) )</div><div class="line">				<span class="keyword">echo</span> <span class="string">'&lt;div class="updated fade"&gt;&lt;p&gt;&lt;strong&gt;Settings saved.&lt;/strong&gt;&lt;/p&gt;'</span>;</div><div class="line">			?&gt;</div><div class="line">			&lt;?php</div><div class="line">			settings_fields(<span class="string">'test_options'</span>);</div><div class="line">			do_settings_sections( <span class="variable">$_GET</span>[<span class="string">'page'</span>] );</div><div class="line">			?&gt;</div><div class="line">			&lt;input type=<span class="string">"submit"</span> name=<span class="string">"test_options[submit]"</span> class=<span class="string">"button-primary"</span> value=<span class="string">"&lt;?php esc_attr_e('Save Changes', 'test'); ?&gt;"</span> /&gt;</div><div class="line">			&lt;input type=<span class="string">"submit"</span> name=<span class="string">"test_options[reset]"</span> class=<span class="string">"button-secondary"</span> onclick=<span class="string">"if(confirm('Are you Sure?')) return true; else return false;"</span> value=<span class="string">"&lt;?php esc_attr_e('Reset to Deafults', 'test'); ?&gt;"</span> /&gt;</div><div class="line">		&lt;/form&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">&lt;?php }</div></code></pre></td></tr></table></figure>

<p>接著新增一個名為<code>display_section</code>的函數，該函數內容可以為空，也可以設定一些文字、HTML 內容等，輸出的內容會顯示在每個區段的最上方。

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display_section</span><span class="params">()</span> {</span></div><div class="line">	<span class="comment">// whatever</span></div><div class="line">}</div></code></pre></td></tr></table></figure>

<h2>顯示選項</h2>
<p>到目前為止，主題選項頁面還是一片白，加入<code>display_settings</code>函數後，主題選項頁面就擁有最基礎的樣貌了。

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div><div class="line-number">24</div><div class="line-number">25</div><div class="line-number">26</div><div class="line-number">27</div><div class="line-number">28</div><div class="line-number">29</div><div class="line-number">30</div><div class="line-number">31</div><div class="line-number">32</div><div class="line-number">33</div><div class="line-number">34</div><div class="line-number">35</div><div class="line-number">36</div><div class="line-number">37</div><div class="line-number">38</div><div class="line-number">39</div><div class="line-number">40</div><div class="line-number">41</div><div class="line-number">42</div><div class="line-number">43</div><div class="line-number">44</div><div class="line-number">45</div><div class="line-number">46</div><div class="line-number">47</div><div class="line-number">48</div><div class="line-number">49</div><div class="line-number">50</div><div class="line-number">51</div><div class="line-number">52</div><div class="line-number">53</div><div class="line-number">54</div><div class="line-number">55</div><div class="line-number">56</div><div class="line-number">57</div><div class="line-number">58</div><div class="line-number">59</div><div class="line-number">60</div><div class="line-number">61</div><div class="line-number">62</div><div class="line-number">63</div><div class="line-number">64</div><div class="line-number">65</div><div class="line-number">66</div><div class="line-number">67</div><div class="line-number">68</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display_settings</span><span class="params">( <span class="variable">$args</span> = array<span class="params">()</span> )</span> {</span></div><div class="line">	extract( <span class="variable">$args</span> );</div><div class="line"> </div><div class="line">	<span class="comment">// 取得資料庫內的現有選項</span></div><div class="line">	<span class="variable">$options</span> = get_option(<span class="string">'test_options'</span>);</div><div class="line"> </div><div class="line">	<span class="comment">// 以下顯示 register_settings 內所設定的選項參數</span></div><div class="line"> </div><div class="line">	<span class="comment">// 如果設定了 class 參數，顯示 class 參數</span></div><div class="line">	<span class="keyword">if</span> ( <span class="variable">$class</span> != <span class="string">''</span> )</div><div class="line">		<span class="keyword">echo</span> <span class="string">'&lt;div class="'</span> . <span class="variable">$class</span> . <span class="string">'"&gt;'</span>;</div><div class="line"> </div><div class="line">	<span class="comment">// 如果設定了選項敘述，顯示選項敘述</span></div><div class="line">	<span class="keyword">if</span> ( <span class="variable">$desc</span> != <span class="string">''</span> )</div><div class="line">		<span class="keyword">echo</span> <span class="variable">$desc</span> . <span class="string">'&lt;br /&gt;'</span>;</div><div class="line"> </div><div class="line">	<span class="comment">// 如果設定了 before 參數，在選項前顯示 before 參數</span></div><div class="line">	<span class="keyword">if</span> ( <span class="variable">$before</span> != <span class="string">''</span> )</div><div class="line">		<span class="keyword">echo</span> <span class="string">'&lt;label for="'</span> . <span class="variable">$id</span> . <span class="string">'"&gt;'</span> . <span class="variable">$before</span> . <span class="string">'&lt;/label&gt;'</span>;</div><div class="line"> </div><div class="line">	<span class="comment">// 偵測選項類型，以下內容可依個人喜好自行設定</span></div><div class="line">	<span class="keyword">switch</span> ( <span class="variable">$type</span> ) {</div><div class="line">		<span class="keyword">case</span> <span class="string">'checkbox'</span>:</div><div class="line">			<span class="keyword">echo</span> <span class="string">'&lt;input type="checkbox" id="'</span> . <span class="variable">$id</span> . <span class="string">'" name="test_options['</span> . <span class="variable">$id</span> . <span class="string">']" value="1"'</span>.checked( <span class="variable">$options</span>[<span class="variable">$id</span>], <span class="number">1</span>, <span class="keyword">false</span> ) . <span class="string">' /&gt;'</span>;</div><div class="line"> </div><div class="line">			<span class="keyword">break</span>;</div><div class="line"> </div><div class="line">		<span class="keyword">case</span> <span class="string">'select'</span>:</div><div class="line">			<span class="keyword">echo</span> <span class="string">'&lt;select name="test_options['</span> . <span class="variable">$id</span> . <span class="string">']"&gt;'</span>;</div><div class="line"> </div><div class="line">			<span class="keyword">foreach</span> ( <span class="variable">$choices</span> <span class="keyword">as</span> <span class="variable">$value</span> =&gt; <span class="variable">$label</span> )</div><div class="line">				<span class="keyword">echo</span> <span class="string">'&lt;option value="'</span> . <span class="variable">$value</span> . <span class="string">'"'</span> . selected( <span class="variable">$options</span>[<span class="variable">$id</span>], <span class="variable">$value</span>, <span class="keyword">false</span> ) . <span class="string">'&gt;'</span> . <span class="variable">$label</span> . <span class="string">'&lt;/option&gt;'</span>;</div><div class="line"> </div><div class="line">			<span class="keyword">echo</span> <span class="string">'&lt;/select&gt;'</span>;</div><div class="line"> </div><div class="line">			<span class="keyword">break</span>;</div><div class="line"> </div><div class="line">		<span class="keyword">case</span> <span class="string">'radio'</span>:</div><div class="line">			<span class="variable">$i</span> = <span class="number">0</span>;</div><div class="line">			<span class="keyword">foreach</span> ( <span class="variable">$choices</span> <span class="keyword">as</span> <span class="variable">$value</span> =&gt; <span class="variable">$label</span> ) {</div><div class="line">				<span class="keyword">echo</span> <span class="string">'&lt;input type="radio" name="test_options['</span> . <span class="variable">$id</span> . <span class="string">']" id="'</span> . <span class="variable">$id</span> . <span class="variable">$i</span> . <span class="string">'" value="'</span> . <span class="variable">$value</span> . <span class="string">'"'</span>. checked( <span class="variable">$options</span>[<span class="variable">$id</span>], <span class="variable">$value</span>, <span class="keyword">false</span> ) . <span class="string">' /&gt;&lt;label for="'</span> . <span class="variable">$id</span> . <span class="string">'"&gt;'</span> . <span class="variable">$label</span> . <span class="string">'&lt;/label&gt;'</span>;</div><div class="line">				<span class="keyword">if</span>( <span class="variable">$i</span> &lt; count(<span class="variable">$options</span>) - <span class="number">1</span> )</div><div class="line">					<span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</div><div class="line">				<span class="variable">$i</span>++;</div><div class="line">			}</div><div class="line"> </div><div class="line">			<span class="keyword">break</span>;</div><div class="line"> </div><div class="line">		<span class="keyword">case</span> <span class="string">'textarea'</span>:</div><div class="line">			<span class="keyword">echo</span> <span class="string">'&lt;textarea id="'</span> . <span class="variable">$id</span> . <span class="string">'" name="test_options['</span> . <span class="variable">$id</span> . <span class="string">']" cols="95%" rows="10"&gt;'</span> . <span class="variable">$options</span>[<span class="variable">$id</span>] . <span class="string">'&lt;/textarea&gt;'</span>;</div><div class="line"> </div><div class="line">			<span class="keyword">break</span>;</div><div class="line"> </div><div class="line">		<span class="keyword">case</span> <span class="string">'text'</span>:</div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			<span class="keyword">echo</span> <span class="string">'&lt;input type="text" id="'</span> . <span class="variable">$id</span> . <span class="string">'" name="test_options['</span> . <span class="variable">$id</span> . <span class="string">']" value="'</span> . <span class="variable">$options</span>[<span class="variable">$id</span>] . <span class="string">'" maxlength="'</span> . <span class="variable">$maxlength</span> . <span class="string">'" /&gt;'</span>;</div><div class="line"> </div><div class="line">			<span class="keyword">break</span>;</div><div class="line">	}</div><div class="line"> </div><div class="line">	<span class="comment">// 如果設定了 after 參數，在選項後顯示 after 參數</span></div><div class="line">	<span class="keyword">if</span> ( <span class="variable">$after</span> != <span class="string">''</span> )</div><div class="line">		<span class="keyword">echo</span> <span class="string">'&lt;label for="'</span> . <span class="variable">$id</span> . <span class="string">'"&gt;'</span> . <span class="variable">$after</span> . <span class="string">'&lt;/label&gt;'</span>;</div><div class="line"> </div><div class="line">	<span class="comment">// 如果設定了 class 參數，以 div 包含選項</span></div><div class="line">	<span class="keyword">if</span> ( <span class="variable">$class</span> != <span class="string">''</span> )</div><div class="line">		<span class="keyword">echo</span> <span class="string">'&lt;/div&gt;'</span>;</div><div class="line">}</div></code></pre></td></tr></table></figure>

<p>設定完成後，主題選項頁面就不再孤寥無幾了，但儲存似乎有些問題？沒錯，因為 Settings API 在<code>checkbox</code>的處理上有些問題，<code>checkbox</code>若停用就不會將數值寫入資料庫了，所以我們必須在選項儲存前先進行驗證，把停用的<code>checkbox</code>值補上<code>0</code>，此外，目前重設按鈕也沒有反應，也必須透過同樣的方式，事先偵測輸入值，若使用者按下重設按鈕，則拋棄現有設定，將開頭所設定的<code>defaults</code>變數寫入資料庫。

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div><div class="line-number">24</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">validate_settings</span><span class="params">( <span class="variable">$input</span> )</span> {</span></div><div class="line"> </div><div class="line">	<span class="variable">$options</span> = get_option(<span class="string">'test_options'</span>);</div><div class="line">	<span class="variable">$valid_input</span> = <span class="variable">$options</span>;</div><div class="line"> </div><div class="line">	<span class="variable">$submit</span> = ( ! <span class="keyword">empty</span>( <span class="variable">$input</span>[<span class="string">'submit'</span>] ) ? <span class="keyword">true</span> : <span class="keyword">false</span> );</div><div class="line">	<span class="variable">$reset</span> = ( ! <span class="keyword">empty</span>( <span class="variable">$input</span>[<span class="string">'reset'</span>] ) ? <span class="keyword">true</span> : <span class="keyword">false</span> );</div><div class="line"> </div><div class="line">	<span class="keyword">if</span> ( <span class="variable">$submit</span> ) {</div><div class="line">		<span class="comment">// 若 checkbox 停用，補 "0" 儲存至資料庫</span></div><div class="line">		<span class="keyword">foreach</span> ( <span class="variable">$this</span>-&gt;checkboxes <span class="keyword">as</span> <span class="variable">$id</span> ) {</div><div class="line">			<span class="keyword">if</span> ( <span class="keyword">isset</span>( <span class="variable">$options</span>[<span class="variable">$id</span>] ) && ! <span class="keyword">isset</span>( <span class="variable">$input</span>[<span class="variable">$id</span>] ) )</div><div class="line">				<span class="variable">$input</span>[<span class="variable">$id</span>] = <span class="string">'0'</span>;</div><div class="line">		}</div><div class="line"> </div><div class="line">		<span class="variable">$valid_input</span> = <span class="variable">$input</span>;</div><div class="line"> </div><div class="line">	} <span class="keyword">elseif</span> ( <span class="variable">$reset</span> ) {</div><div class="line">		<span class="comment">// 使用事先設定的預設值寫入資料庫</span></div><div class="line">		<span class="variable">$valid_input</span> = <span class="variable">$this</span>-&gt;defaults;</div><div class="line">	}</div><div class="line"> </div><div class="line">	<span class="keyword">return</span> <span class="variable">$valid_input</span>;</div><div class="line">}</div></code></pre></td></tr></table></figure>

<h2>自定 JavaScript 與 CSS 樣式</h2>
<p>如果只是基本的主題選項的話，第四步便可以宣告結束了，但如果想要進一步的設定 Javascript 與 CSS 樣式呢？你可以加入以下的函數，直接引入外部檔案，或是直接寫在 PHP 檔案也可以。<br><em>※ 附註：若直接使用 $ 當作 jQuery 標籤的話，可能會有衝突問題，請使用其他字串代替，或改為<code>jQuery(document).ready(function($){...});</code></em>

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">styles</span><span class="params">()</span> {</span></div><div class="line">	wp_enqueue_style(<span class="string">'testAdminCSS'</span>, get_template_directory_uri().<span class="string">'/admin/admin.css'</span>);</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="comment">// 引入 Javascript</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">scripts</span><span class="params">()</span> {</span></div><div class="line">	wp_enqueue_script(<span class="string">'testAdminJS'</span>, get_template_directory_uri().<span class="string">'/admin/admin.js'</span>);</div><div class="line">}</div></code></pre></td></tr></table></figure>

<p>然後在<code>add_pages</code>函數中，加入以下程式碼，就可成功引入 CSS 與 Javascript 了。

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div></code></pre></td><td class="code"><pre><code><div class="line">add_action( <span class="string">'admin_print_scripts-'</span> . <span class="variable">$admin_page</span>, <span class="keyword">array</span>( &<span class="variable">$this</span>, <span class="string">'scripts'</span> ) );</div><div class="line">add_action( <span class="string">'admin_print_styles-'</span> . <span class="variable">$admin_page</span>, <span class="keyword">array</span>( &<span class="variable">$this</span>, <span class="string">'styles'</span> ) );</div></code></pre></td></tr></table></figure>

<p>那麼該如何做出 Pixiv Custom 式樣的分頁呢？因為我 PHP 功力差，所以主要透過 Javascript 來包裝，你或許會有更好的方法也說不定。
首先，修改<code>display_page</code>函數，在你喜歡的地方加入以下程式碼：

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div></code></pre></td><td class="code"><pre><code><div class="line">&lt;div id="test_switch"&gt;</div><div class="line">&lt;a id="tab0"&gt; 分頁 1&lt;/a&gt;</div><div class="line">&lt;a id="tab1"&gt; 分頁 2&lt;/a&gt;</div><div class="line">&lt;!-- 依此類推... --&gt;</div><div class="line">&lt;/div&gt;</div></code></pre></td></tr></table></figure>

<p>這樣選項頁面就會出現各個區段的連結文字了，接下來只要透過 Javascript 包裝表格，搭配 CSS 控制表格顯示即可。<br><em>※ ID 必須符合<code>__construct</code>函數中的參數，前面再加上上述程式碼的前綴字元。</em>

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div><div class="line-number">24</div><div class="line-number">25</div><div class="line-number">26</div><div class="line-number">27</div><div class="line-number">28</div><div class="line-number">29</div><div class="line-number">30</div><div class="line-number">31</div><div class="line-number">32</div><div class="line-number">33</div><div class="line-number">34</div><div class="line-number">35</div><div class="line-number">36</div><div class="line-number">37</div><div class="line-number">38</div><div class="line-number">39</div><div class="line-number">40</div><div class="line-number">41</div><div class="line-number">42</div><div class="line-number">43</div><div class="line-number">44</div><div class="line-number">45</div><div class="line-number">46</div><div class="line-number">47</div><div class="line-number">48</div><div class="line-number">49</div><div class="line-number">50</div><div class="line-number">51</div><div class="line-number">52</div><div class="line-number">53</div><div class="line-number">54</div><div class="line-number">55</div><div class="line-number">56</div><div class="line-number">57</div><div class="line-number">58</div><div class="line-number">59</div><div class="line-number">60</div><div class="line-number">61</div><div class="line-number">62</div><div class="line-number">63</div></code></pre></td><td class="code"><pre><code><div class="line">jQuery(document).ready(<span class="keyword">function</span>($){</div><div class="line">	<span class="keyword">var</span> cookie = $.cookie(<span class="string">'pixiv_tabs'</span>) || <span class="number">0</span>;</div><div class="line">	showTab(cookie);</div><div class="line"> </div><div class="line">	$(<span class="string">"#pixiv_switch a"</span>).click(<span class="keyword">function</span>(){</div><div class="line">		<span class="keyword">var</span> tab = $(<span class="keyword">this</span>).prop(<span class="string">'id'</span>).replace(<span class="regexp">/tab/</span>,<span class="string">''</span>);</div><div class="line">		showTab(tab);</div><div class="line">	});</div><div class="line">});</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showTab</span><span class="params">(id)</span>{</span></div><div class="line">	jQuery(<span class="string">'#test_switch a'</span>).removeClass(<span class="string">'current'</span>);</div><div class="line">	jQuery(<span class="string">'#test_switch a'</span>).eq(id).addClass(<span class="string">'current'</span>);</div><div class="line">	jQuery(<span class="string">'form#test table'</span>).hide();</div><div class="line">	jQuery(<span class="string">'form#test table'</span>).eq(id).fadeIn();</div><div class="line">	jQuery.cookie(<span class="string">'test_tabs'</span>,id,{expires: <span class="number">0.5</span>});</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="comment">/**</div><div class="line"> * Cookie plugin</div><div class="line"> *</div><div class="line"> * Copyright (c) 2006 Klaus Hartl (stilbuero.de)</div><div class="line"> * Dual licensed under the MIT and GPL licenses:</div><div class="line"> * http://www.opensource.org/licenses/mit-license.php</div><div class="line"> * http://www.gnu.org/licenses/gpl.html</div><div class="line"> *</div><div class="line"> */</span></div><div class="line">jQuery.cookie = <span class="keyword">function</span>(name, value, options) {</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> value != <span class="string">'undefined'</span>) {</div><div class="line">        options = options || {};</div><div class="line">        <span class="keyword">if</span> (value === <span class="literal">null</span>) {</div><div class="line">            value = <span class="string">''</span>;</div><div class="line">            options.expires = -<span class="number">1</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">var</span> expires = <span class="string">''</span>;</div><div class="line">        <span class="keyword">if</span> (options.expires && (<span class="keyword">typeof</span> options.expires == <span class="string">'number'</span> || options.expires.toUTCString)) {</div><div class="line">            <span class="keyword">var</span> date;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> options.expires == <span class="string">'number'</span>) {</div><div class="line">                date = <span class="keyword">new</span> Date();</div><div class="line">                date.setTime(date.getTime() + (options.expires * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>));</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                date = options.expires;</div><div class="line">            }</div><div class="line">            expires = <span class="string">'; expires='</span> + date.toUTCString();</div><div class="line">        }</div><div class="line">        <span class="keyword">var</span> path = options.path ? <span class="string">'; path='</span> + (options.path) : <span class="string">''</span>;</div><div class="line">        <span class="keyword">var</span> domain = options.domain ? <span class="string">'; domain='</span> + (options.domain) : <span class="string">''</span>;</div><div class="line">        <span class="keyword">var</span> secure = options.secure ? <span class="string">'; secure'</span> : <span class="string">''</span>;</div><div class="line">        document.cookie = [name, <span class="string">'='</span>, encodeURIComponent(value), expires, path, domain, secure].join(<span class="string">''</span>);</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        <span class="keyword">var</span> cookieValue = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">if</span> (document.cookie && document.cookie != <span class="string">''</span>) {</div><div class="line">            <span class="keyword">var</span> cookies = document.cookie.split(<span class="string">';'</span>);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cookies.length; i++) {</div><div class="line">                <span class="keyword">var</span> cookie = jQuery.trim(cookies[i]);</div><div class="line">                <span class="keyword">if</span> (cookie.substring(<span class="number">0</span>, name.length + <span class="number">1</span>) == (name + <span class="string">'='</span>)) {</div><div class="line">                    cookieValue = decodeURIComponent(cookie.substring(name.length + <span class="number">1</span>));</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> cookieValue;</div><div class="line">    }</div><div class="line">};</div></code></pre></td></tr></table></figure>

<h2>套用</h2>
<p>這個步驟相對而言就比較簡單了，首先在想要套用選項的位置加入以下程式碼，並設定

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div><div class="line-number">24</div><div class="line-number">25</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="variable">$option</span> = get_options(<span class="string">'test_options'</span>);</div><div class="line"> </div><div class="line"><span class="comment">// checkbox 的情況</span></div><div class="line"><span class="keyword">if</span> ( <span class="variable">$options</span>[<span class="string">'test_checkbox'</span>] ) {</div><div class="line">	...</div><div class="line">} <span class="keyword">else</span> {</div><div class="line">	...</div><div class="line">}</div><div class="line"><span class="comment">// 也可使用以下寫法</span></div><div class="line"><span class="variable">$options</span>[<span class="string">'test_checkbox'</span>] ? ... : ...;</div><div class="line"> </div><div class="line"><span class="comment">// text, textarea 的情況</span></div><div class="line"><span class="keyword">if</span> ( <span class="variable">$options</span>[<span class="string">'test_text'</span>] ) {</div><div class="line">	<span class="keyword">echo</span> <span class="variable">$options</span>[<span class="string">'test_text'</span>];</div><div class="line">	...</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="comment">// select, radio 的情況</span></div><div class="line"><span class="keyword">if</span> ( <span class="variable">$options</span>[<span class="string">'test_select'</span>] == <span class="string">'one'</span> ) {</div><div class="line">	...</div><div class="line">} <span class="keyword">elseif</span> ( <span class="variable">$options</span>[<span class="string">'test_select'</span>] == <span class="string">'two'</span> ) {</div><div class="line">	...</div><div class="line">} <span class="keyword">else</span> {</div><div class="line">	...</div><div class="line">}</div></code></pre></td></tr></table></figure>

<h2>參考出處</h2>
<p><a href="http://alisothegeek.com/2011/01/wordpress-settings-api-tutorial-1/">Extended WordPress Settings API Tutorial</a><br><a href="http://www.chipbennett.net/2011/02/17/incorporating-the-settings-api-in-wordpress-themes">Incorporating the Settings API in WordPress Themes</a><br><a href="http://codex.wordpress.org/Main_Page">WordPress Codex</a><br><a href="https://github.com/carhartl/jquery-cookie">jQuery cookie plugin</a>

</p>
<h2>後記</h2>
<p>這大概是我寫過最長的一篇文章，內容可能會有點枯燥乏味、充滿錯誤，<del>而且一張萌圖都沒有</del>，各位客倌就把這當成一篇筆記文章吧！</p>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/WordPress/">WordPress</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4daee9911f9dfcb4"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</div></div>
    <aside id="sidebar" class="alignright">
<div class="search">
  <form action="http://google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:zespia.tw">
  </form>
</div>


<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Android/">Android</a><small>1</small></li>
  
    <li><a href="/tags/CSS/">CSS</a><small>1</small></li>
  
    <li><a href="/tags/HTML5/">HTML5</a><small>2</small></li>
  
    <li><a href="/tags/Hexo/">Hexo</a><small>3</small></li>
  
    <li><a href="/tags/JavaScript/">JavaScript</a><small>8</small></li>
  
    <li><a href="/tags/Node.js/">Node.js</a><small>5</small></li>
  
    <li><a href="/tags/Octopress/">Octopress</a><small>4</small></li>
  
    <li><a href="/tags/PS3/">PS3</a><small>6</small></li>
  
    <li><a href="/tags/PSP/">PSP</a><small>2</small></li>
  
    <li><a href="/tags/Ruby/">Ruby</a><small>1</small></li>
  
    <li><a href="/tags/Windows/">Windows</a><small>1</small></li>
  
    <li><a href="/tags/WordPress/">WordPress</a><small>5</small></li>
  
    <li><a href="/tags/主題/">主題</a><small>6</small></li>
  
    <li><a href="/tags/同人誌/">同人誌</a><small>2</small></li>
  
    <li><a href="/tags/活動/">活動</a><small>2</small></li>
  
    <li><a href="/tags/漫畫/">漫畫</a><small>6</small></li>
  
    <li><a href="/tags/輕小說/">輕小說</a><small>8</small></li>
  
    <li><a href="/tags/遊戲/">遊戲</a><small>8</small></li>
  
  </ul>
</div>



<div class="widget twitter">
  <h3 class="title">Tweets</h3>
  <ul id="tweets"></ul>
</div>

<script type="text/javascript">
var twitter_stream = ['tommy351', 5, false];
</script>
<script src="/js/twitter.js"></script>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 SkyArrow
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'zespiatw';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>